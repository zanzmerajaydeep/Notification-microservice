package com.smsservice.controller;

import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.smsservice.model.Admin;
import com.smsservice.model.SMS;
import com.smsservice.repo.AdminRepository;
import com.smsservice.repo.SMSRepository;
import com.smsservice.service.SMSService;
import com.twilio.Twilio;
import com.twilio.rest.api.v2010.account.Message;
import com.twilio.rest.lookups.v1.PhoneNumber;
import com.twilio.type.PhoneNumberPrice;

@RestController
@RequestMapping("/sms")
public class SMSController {
	
	@Autowired
	SMSRepository smsrepo;
	
	@Autowired
	AdminRepository arepo;
	
	@Autowired
	SMSService smsservice;
	
	@GetMapping("/home")
	public String getHome() {
		return "Home sms service....";
	}
	
//	@GetMapping("/insert")
//	public String insertEmail() {
//		Admin a = new Admin("AC25cc3dbe3bb5fe84d77b3f1e2b099306","b5d8032407f665eb1fa7dafe1b395ce9","+15075026664");
//		arepo.save(a);
//		return "inserted";
//	}
	
//	@PostMapping(value = "/sendsms")
//	public String sendSMS(@RequestParam String smsTO,String name,String percentage,String adminname,String universityname) {
//		SMS s = smsrepo.findById("642580fed704843a38b3551e").get();
//		String bd[] = s.getBody().split("\\$");
//
//		String body = bd[0]+name+bd[1]+percentage+"%"+bd[2]+adminname+bd[3]+universityname+bd[4];
//		
//		smsservice.sendSMS("+91"+smsTO, s.getSubject(), body);
//	
//		return "sent...";
//	}
	
	@PostMapping(value = "/sendsms")
	public String sendSMS(@RequestBody Map<String, Object> smsData) {
		
		
		
		smsservice.sendSMS(smsData);
	
		return "sent...";
	}
}
